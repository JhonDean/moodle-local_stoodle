{"version":3,"file":"quiz.min.js","sources":["../src/quiz.js"],"sourcesContent":["export const init = () => {\n    const questionSet = JSON.parse(document.getElementById(\"question-set\").innerHTML);\n    const answerSet = JSON.parse(document.getElementById(\"answer-set\").innerHTML);\n    const questionDiv = document.querySelector(\".js-answer-area\");\n    const scoreArea = document.querySelector(\".score\");\n\n    // Organize information for easier access\n    const quizMap = createQuizHash(questionSet, answerSet);\n    const questionTypes = declareQuestionTypes(questionSet, answerSet);\n\n    scoreArea.innerHTML = M.util.get_string('js_quiz_scoretext', 'local_stoodle', {current: 0, total: quizMap.size});\n    document.querySelector(\".submit-button\").addEventListener('click', () => {\n        questionValidation();\n    });\n\n    // Create questions and answer options\n    let index = 0;\n    for (const [key, value] of quizMap.entries()) {\n        const optionArray = value[0];\n\n        // Set up div to house quiz question\n        const newDiv = document.createElement(\"div\");\n        newDiv.id = \"stoodle-div\";\n        const questionText = document.createElement(\"p\");\n        questionText.id = \"stoodle-question-text\";\n        questionText.textContent = M.util.get_string('js_quiz_questiontext', 'local_stoodle', {num: index + 1, text: key});\n        newDiv.appendChild(questionText);\n\n        switch (questionTypes[index]) {\n            default:\n            case 0:\n                newDiv.id = \"open-response\";\n                createOpenResponseQuestion(newDiv, (\"option_\" + index));\n                break;\n            case 1:\n                newDiv.id = \"multiple-choice\";\n                for (const element in value[0]) {\n                    createInputNode(newDiv, (\"option_\" + index), index, optionArray[element], \"radio\");\n                }\n                break;\n            case 2:\n                newDiv.id = \"select-all\";\n                for (const element in value[0]) {\n                    createInputNode(newDiv, (\"option_\" + index), index, optionArray[element], \"checkbox\");\n                }\n                break;\n        }\n\n        questionDiv.appendChild(newDiv);\n        index++;\n    }\n\n    /**\n     * Creates a open response question.\n     *\n     * @param {object} parent\n     * @param {string} name\n     */\n    function createOpenResponseQuestion(parent, name) {\n        const label = document.createElement(\"label\");\n        const textInput = document.createElement(\"textarea\");\n        textInput.id = name;\n        textInput.cols = 100;\n        label.appendChild(textInput);\n        parent.appendChild(label);\n    }\n\n    /**\n     * Creates an input using a given type.\n     *\n     * @param {object} parent The node for which the new input node should be parented to.\n     * @param {string} id The id for the new input node.\n     * @param {string} name The name for the input node.\n     * @param {string} value The value for the new input node.\n     * @param {string} type The type of the new input node.\n     */\n    function createInputNode(parent, id, name, value, type) {\n        // Create a checkbox input\n        const input = document.createElement(\"input\");\n        input.type = type;\n        input.id = id;\n        input.name = name;\n        input.value = value;\n        if (type === \"radio\") {\n            input.className = \"stoodle-radio-btn\";\n        }\n\n        // Create the label to go with it\n        const label = document.createElement(\"label\");\n        label.appendChild(input);\n        label.appendChild(document.createTextNode(value));\n\n        // Append them to the parent\n        parent.appendChild(label);\n        parent.appendChild(document.createElement(\"br\"));\n    }\n\n    /**\n     * Validates the questions on the quiz. Checks if right or wrong.\n     *\n     */\n    function questionValidation() {\n        const correctIcon = \"\\u{2705}\";\n        const incorrectIcon = \"\\u{274C}\";\n        let numCorrect = 0;\n        let index = 0;\n\n        // Check selected option against answer in the map\n        for (const [key, value] of quizMap.entries()) {\n            const answerArray = value[1];\n            const htmlQuestionP = questionDiv.children[index].children[0];\n            const questionText = M.util.get_string('js_quiz_questiontext', 'local_stoodle', {num: index + 1, text: key});\n            let finalIcon = incorrectIcon;\n\n            if (questionTypes[index] === 0) {\n                // Check Open Response\n                const option = document.getElementById(\"option_\" + index);\n                if (option.value === answerArray[0]) {\n                    numCorrect++;\n                    finalIcon = correctIcon;\n                }\n            } else if (questionTypes[index] === 1) {\n                // Check Multiple Choice\n                const option = document.querySelector('input[name= \"' + index + '\"]:checked');\n                if (option === null) {\n                    alert(M.util.get_string('js_quiz_unansweredtext', 'local_stoodle', index + 1));\n                    return;\n                }\n                if (answerArray[0] === option.value) {\n                    numCorrect++;\n                    finalIcon = correctIcon;\n                }\n            } else if (questionTypes[index] === 2) {\n                // Check Select All\n                const option = document.querySelectorAll('input[name=\"' + index + '\"]:checked');\n                if (option.length < 1) {\n                    alert(M.util.get_string('js_quiz_unansweredtext', 'local_stoodle', index + 1));\n                    return;\n                }\n                let selectAllCorrectCounter = 0;\n                for (let i = 0; i < answerArray.length && answerArray.length === option.length; i++) {\n                    if (answerArray[i] === option[i].value) {\n                        selectAllCorrectCounter++;\n                    }\n                }\n                if (selectAllCorrectCounter === answerArray.length) {\n                    numCorrect++;\n                    finalIcon = correctIcon;\n                }\n            }\n            htmlQuestionP.innerText = questionText + finalIcon;\n            index++;\n        }\n        scoreArea.innerText = M.util.get_string('js_quiz_scoretext', 'local_stoodle', {current: numCorrect, total: quizMap.size});\n    }\n\n    /**\n     * Returns an array with question types.\n     * 0 - Open Response,\n     * 1 - Multiple Choice,\n     * 2 - Select All\n     *\n     * @param {Object} questions\n     * @param {Object} options\n     * @return {Array} Resulting array with question types.\n     */\n    function declareQuestionTypes(questions, options) {\n        const questionTypesArray = new Array(Object.values(questions).length);\n        for (const questionKey in Object.values(questions)) {\n            const questionId = parseInt(Object.values(questions)[questionKey].id);\n            let count = 0;\n            for (const answerKey in Object.values(options)) {\n                const answerObject = Object.values(options)[answerKey];\n                if (parseInt(answerObject.stoodle_quiz_questionsid) === questionId && parseInt(answerObject.is_correct) === 1) {\n                    count++;\n                }\n            }\n            if (count > 1) {\n                questionTypesArray[questionKey] = 2;\n            } else if (count === 1 && parseInt(Object.values(questions)[questionKey].is_multiple_choice) === 1) {\n                questionTypesArray[questionKey] = 1;\n            } else {\n                questionTypesArray[questionKey] = 0;\n            }\n        }\n        return questionTypesArray;\n    }\n\n    /**\n     * Creates a Map by matching questions to their options in their respective sets.\n     * Consists of the question text as the key, and an array containing a set of all options and a set of correct options.\n     *\n     * @param {Object} qSet Set of all questions\n     * @param {Object} oSet Set of all options\n     * @return {Map} Resulting array\n     */\n    function createQuizHash(qSet, oSet) {\n        let resultSet = new Map();\n        for (const qKey in Object.values(qSet)) {\n            let optionArray = [];\n            let answerArray = [];\n            for (const oKey in Object.values(oSet)) {\n                const dbQuestionKey = parseInt(Object.values(qSet)[qKey].id);\n                const dbOptionKey = parseInt(Object.values(oSet)[oKey].stoodle_quiz_questionsid);\n                if (dbQuestionKey === dbOptionKey) {\n                    optionArray.push(Object.values(oSet)[oKey].option_text);\n                    if (parseInt(Object.values(oSet)[oKey].is_correct) === 1) {\n                        answerArray.push(Object.values(oSet)[oKey].option_text);\n                    }\n                }\n            }\n            resultSet.set(Object.values(qSet)[qKey].question_text, [optionArray, answerArray]);\n        }\n        return resultSet;\n    }\n};\n"],"names":["questionSet","JSON","parse","document","getElementById","innerHTML","answerSet","questionDiv","querySelector","scoreArea","quizMap","qSet","oSet","resultSet","Map","qKey","Object","values","optionArray","answerArray","oKey","dbQuestionKey","parseInt","id","dbOptionKey","stoodle_quiz_questionsid","push","option_text","is_correct","set","question_text","createQuizHash","questionTypes","questions","options","questionTypesArray","Array","length","questionKey","questionId","count","answerKey","answerObject","is_multiple_choice","declareQuestionTypes","M","util","get_string","current","total","size","addEventListener","correctIcon","incorrectIcon","numCorrect","index","key","value","entries","htmlQuestionP","children","questionText","num","text","finalIcon","option","alert","querySelectorAll","selectAllCorrectCounter","i","innerText","questionValidation","newDiv","createElement","textContent","appendChild","createOpenResponseQuestion","element","createInputNode","parent","name","label","textInput","cols","type","input","className","createTextNode"],"mappings":"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"}